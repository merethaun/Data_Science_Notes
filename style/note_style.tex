\newcounter{bordercntr}
\newcounter{borderpages}

\newcommand\tikzmark[1]{%
  \tikz[overlay,remember picture] \node[inner xsep=0pt] (#1) {};}

\newenvironment{tikzborder}[2][7pt]
{%
  \gdef\borderspacing{#1}
  \stepcounter{bordercntr}%
  \tikzmark{start-border}\label{start-border\thebordercntr}%
  \tikz[remember picture,overlay]
    \node[anchor=north west,inner sep=0pt,text=gray,font=\footnotesize] at 
  ([xshift=\marginparsep,yshift=0.65ex]current page text area.east|-start-border.north)
  {\parbox{\dimexpr\marginparwidth+0.5cm\relax}{\begin{spacing}{0.8}\raggedright#2\end{spacing}}};%
  % if the marks are in the same page, nothing is done
  % otherwise, the decoration is drawn from the starting point to the page bottom
  % and, if necessary, intermediate pages will also receive the decoration
  \ifnum\getpagerefnumber{start-border\thebordercntr}=\getpagerefnumber{end-border\thebordercntr}\else
    \begin{tikzpicture}[overlay, remember picture]
    \draw [thin, gray] % Adjusted line thickness here (e.g., 'thin')
         ([xshift=\borderspacing,yshift=0.65ex]current page text area.east|-start-border.north) --  
         ([xshift=\borderspacing]current page text area.south east);
    \end{tikzpicture}%
    \setcounter{borderpages}{\numexpr\getpagerefnumber{end-border\thebordercntr}-\getpagerefnumber{start-border\thebordercntr}}%
    \ifnum\value{borderpages}>1\relax
      \AtBeginShipoutNext{\tikzborderpage[#1]}%
    \fi%
  \fi%
\ignorespaces%
}
{\tikzmark{end-border}\label{end-border\thebordercntr}%
  % if the marks are in the same page, the decoration is drawn
  % otherwise, the decoration is drawn from the top of the page to the end mark
  \ifnum\getpagerefnumber{start-border\thebordercntr}=\getpagerefnumber{end-border\thebordercntr}%
    \begin{tikzpicture}[overlay, remember picture]
    \draw [thin, gray] % Adjusted line thickness here (e.g., 'thin')
         ([xshift=\borderspacing,yshift=0.65ex]current page text area.east|-start-border.north) --  
         ([xshift=\borderspacing,yshift=0.65ex]current page text area.east|-end-border.south);
    \end{tikzpicture}%
  \else
    \begin{tikzpicture}[overlay, remember picture]
    \draw [thin, gray] % Adjusted line thickness here (e.g., 'thin')
         ([xshift=\borderspacing]current page text area.north east) --  
         ([xshift=\borderspacing,yshift=0.65ex]current page text area.east|-end-border.south);
    \end{tikzpicture}%
  \fi%
}

% the command to draw the decoration in intermediate pages from the top
% to the bottom of the page
\newcommand\tikzborderpage[1][0pt]{%
  \begin{tikzpicture}[overlay, remember picture]
    \draw[thin, gray] % Adjusted line thickness here (e.g., 'thin')
         ([xshift=\borderspacing,yshift=-\baselineskip]current page text area.north east) --  
         ([xshift=\borderspacing,yshift=0.65ex]current page text area.south east);
  \end{tikzpicture}
  \addtocounter{borderpages}{-1}%
  \ifnum\value{borderpages}>1
    \AtBeginShipoutNext{\tikzborderpage[#1]}%
  \fi%
}